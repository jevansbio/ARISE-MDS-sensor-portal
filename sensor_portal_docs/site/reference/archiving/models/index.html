<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>models - ARISE MDS sensor portal help</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "models";
        var mkdocs_page_input_path = "reference\\archiving\\models.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> ARISE MDS sensor portal help
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../about/">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Data structure</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/project/">Project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/device/">Device</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/deployment/">Deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/datafile/">Datafile</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Model detail</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/site/">Site</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datatype/">DataType</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/project/">Project</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/devicemodel/">DeviceModel</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/device/">Device</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/deployment/">Deployment</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datafile/">DataFile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/taxon/">Taxon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/observation/">Observation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datapackage/">DataPackage</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/">Index</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/arise_mds_api_examples/">Examples</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/upload_data_workflow/">Upload example</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For developers</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/data_handlers/">Data handlers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/generic_jobs/">Generic jobs</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Code Reference</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../ai_integration/">ai_integration</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../ai_integration/tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="../">archiving</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../bagit_functions/">bagit_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../functions/">functions</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">models</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../tar_functions/">tar_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../camtrap_dp_export/">camtrap_dp_export</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/querysets/">querysets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_handlers/">data_handlers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/base_data_handler_class/">base_data_handler_class</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/functions/">functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/post_upload_task_handler/">post_upload_task_handler</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_models/">data_models</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/file_handling_functions/">file_handling_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/general_functions/">general_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/job_handling_functions/">job_handling_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/plotting_functions/">plotting_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/signals/">signals</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/validators/">validators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_packages/">data_packages</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/create_zip_functions/">create_zip_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../dsi/">dsi</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../dsi/api_client/">api_client</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../dsi/api_functions/">api_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../dsi/tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../external_storage_import/">external_storage_import</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observation_editor/">observation_editor</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/GBIF_functions/">GBIF_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../user_management/">user_management</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/signals/">signals</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/views/">views</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/">utils</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/api_renderer/">api_renderer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/email/">email</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/general/">general</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/paginators/">paginators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/perm_functions/">perm_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/querysets/">querysets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/ssh_client/">ssh_client</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/task_functions/">task_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/test_functions/">test_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/validators/">validators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/views/">views</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >uva_jobs</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../uva_jobs/tasks/">tasks</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For admin</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../admin/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../UVA/UVA/">UVA management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../admin/permissions/">Permissions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Admin only models details</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/projectjob/">Project Job</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/data_storage_input/">Data Storage input</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/archive/">Archive</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/tarfile/">TAR file</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">ARISE MDS sensor portal help</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">For developers</li>
          <li class="breadcrumb-item">Code Reference</li>
          <li class="breadcrumb-item"><a href="../">archiving</a></li>
      <li class="breadcrumb-item active">models</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="archiving.models"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="archiving.models.Archive" class="doc doc-heading">
            <code>Archive</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>








              <details class="quote">
                <summary>Source code in <code>archiving\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class Archive(BaseModel):
    name = models.CharField(
        max_length=200,
        help_text="A human-readable name for this archive."
    )
    username = models.CharField(
        max_length=50,
        unique=True,
        help_text="Username for SSH login to the archive server."
    )
    password = EncryptedCharField(
        max_length=128,
        help_text="Password for SSH login to the archive server. Stored encrypted."
    )
    address = models.CharField(
        max_length=100,
        unique=True,
        help_text="Network address of the archive server."
    )
    owner = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        blank=True,
        related_name="owned_archives",
        on_delete=models.SET_NULL,
        null=True,
        help_text="User who owns this archive."
    )
    root_folder = models.CharField(
        max_length=100,
        unique=True,
        help_text="Root folder path on the archive server."
    )

    def __str__(self) -&gt; str:
        """Return the name of the archive."""
        return self.name

    def init_ssh_client(self) -&gt; SSH_client:
        """Initialize an SSH client for this archive."""
        return SSH_client(self.username, self.password, self.address, 22)

    def check_projects(self) -&gt; None:
        """Check and update archive projects."""
        from .functions import check_archive_projects
        check_archive_projects(self)

    def check_upload(self) -&gt; None:
        """Check and update archive uploads."""
        from .functions import check_archive_upload
        check_archive_upload(self)</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="archiving.models.Archive.__str__" class="doc doc-heading">
            <code class="highlight language-python">__str__()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the name of the archive.</p>


            <details class="quote">
              <summary>Source code in <code>archiving\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def __str__(self) -&gt; str:
    """Return the name of the archive."""
    return self.name</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="archiving.models.Archive.check_projects" class="doc doc-heading">
            <code class="highlight language-python">check_projects()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Check and update archive projects.</p>


            <details class="quote">
              <summary>Source code in <code>archiving\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_projects(self) -&gt; None:
    """Check and update archive projects."""
    from .functions import check_archive_projects
    check_archive_projects(self)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="archiving.models.Archive.check_upload" class="doc doc-heading">
            <code class="highlight language-python">check_upload()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Check and update archive uploads.</p>


            <details class="quote">
              <summary>Source code in <code>archiving\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_upload(self) -&gt; None:
    """Check and update archive uploads."""
    from .functions import check_archive_upload
    check_archive_upload(self)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="archiving.models.Archive.init_ssh_client" class="doc doc-heading">
            <code class="highlight language-python">init_ssh_client()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize an SSH client for this archive.</p>


            <details class="quote">
              <summary>Source code in <code>archiving\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def init_ssh_client(self) -&gt; SSH_client:
    """Initialize an SSH client for this archive."""
    return SSH_client(self.username, self.password, self.address, 22)</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="archiving.models.TarFile" class="doc doc-heading">
            <code>TarFile</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>








              <details class="quote">
                <summary>Source code in <code>archiving\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class TarFile(BaseModel):
    name = models.CharField(
        max_length=200,
        help_text="Filename of the TAR archive (without extension)."
    )
    archived_dt = models.DateTimeField(
        default=djtimezone.now,
        help_text="Datetime this TAR was archived."
    )
    uploading = models.BooleanField(
        default=False,
        help_text="True if the TAR is currently uploading."
    )
    local_storage = models.BooleanField(
        default=True,
        help_text="True if the TAR is stored locally."
    )
    archived = models.BooleanField(
        default=False,
        help_text="True if the TAR is archived remotely."
    )
    path = models.CharField(
        max_length=500,
        blank=True,
        help_text="Filesystem path to the TAR archive."
    )
    archive = models.ForeignKey(
        Archive,
        related_name="tar_files",
        on_delete=models.PROTECT,
        null=True,
        help_text="Archive to which this TAR file belongs."
    )

    def __str__(self) -&gt; str:
        """Return the name of the TAR file."""
        return self.name

    def clean_tar(self, delete_obj: bool = False, force_delete: bool = False) -&gt; bool:
        """
        Remove the TAR file from storage and update the database accordingly.

        Args:
            delete_obj (bool): If True, delete the database object.
            force_delete (bool): If True, force deletion even if errors occur.

        Returns:
            bool: True if successful, False otherwise.
        """
        logger.info(
            f"Clean TAR file {self.name} - Delete object: {delete_obj}")
        if not self.local_storage and not self.archived and not self.uploading:
            logger.info(
                f"Clean TAR file {self.name} - object exists only in database")
            return True
        if self.local_storage:
            tar_name = self.name
            if ".tar.gz" not in tar_name:
                tar_name = tar_name + ".tar.gz"
            tar_path = os.path.join(
                settings.FILE_STORAGE_ROOT, self.path, tar_name)
            logger.info(
                f"Clean TAR file {self.name} - try to delete local TAR")

            success = try_remove_file_clean_dirs(tar_path)

            if not success and not force_delete:
                logger.error(
                    f"Clean TAR file {self.name} - failed - could not delete local TAR")
                return False
            elif success:
                logger.info(
                    f"Clean TAR file {self.name} - try to delete local TAR - success")

            if not delete_obj:
                logger.info(
                    f"Clean TAR file {self.name} - Alter database object")
                self.local_storage = False
                self.save()

            return True

        elif not self.local_storage and delete_obj and force_delete:
            if not all(self.files.values_list("local_storage", flat=True)):
                logger.error(
                    f"{self.name}: Some files contained in this TAR are no longer stored locally. The remote TAR cannot be deleted.")
                return False
            self.files.all().update(archived=False)
            ssh_client = self.archive.init_ssh_client()
            ssh_connect_success = ssh_client.connect_to_ssh()
            if not ssh_connect_success:
                return False
            remote_path = posixjoin(self.path, self.name + ".tar.gz")
            status_code, stdout, stderr = ssh_client.send_ssh_command(
                f"rm {remote_path}")
            if status_code != 0:
                remote_path = posixjoin(self.path, self.name)
                status_code, stdout, stderr = ssh_client.send_ssh_command(
                    f"rm {remote_path}")
            if status_code != 0:
                logger.info(f"{self.name}: Cannot remove remote TAR. {stdout}")
                return False
            else:
                logger.info(f"{self.name}: Remote TAR removed.")
                status_code, stdout, stderr = ssh_client.send_ssh_command(
                    f"find {self.path} -type d -empty -delete")
                return True
        else:
            return False</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="archiving.models.TarFile.__str__" class="doc doc-heading">
            <code class="highlight language-python">__str__()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the name of the TAR file.</p>


            <details class="quote">
              <summary>Source code in <code>archiving\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def __str__(self) -&gt; str:
    """Return the name of the TAR file."""
    return self.name</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="archiving.models.TarFile.clean_tar" class="doc doc-heading">
            <code class="highlight language-python">clean_tar(delete_obj=False, force_delete=False)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove the TAR file from storage and update the database accordingly.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>delete_obj</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, delete the database object.</p>
              </div>
            </li>
            <li>
              <b><code>force_delete</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, force deletion even if errors occur.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="bool">bool</span></code>
)              –
              <div class="doc-md-description">
                <p>True if successful, False otherwise.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>archiving\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def clean_tar(self, delete_obj: bool = False, force_delete: bool = False) -&gt; bool:
    """
    Remove the TAR file from storage and update the database accordingly.

    Args:
        delete_obj (bool): If True, delete the database object.
        force_delete (bool): If True, force deletion even if errors occur.

    Returns:
        bool: True if successful, False otherwise.
    """
    logger.info(
        f"Clean TAR file {self.name} - Delete object: {delete_obj}")
    if not self.local_storage and not self.archived and not self.uploading:
        logger.info(
            f"Clean TAR file {self.name} - object exists only in database")
        return True
    if self.local_storage:
        tar_name = self.name
        if ".tar.gz" not in tar_name:
            tar_name = tar_name + ".tar.gz"
        tar_path = os.path.join(
            settings.FILE_STORAGE_ROOT, self.path, tar_name)
        logger.info(
            f"Clean TAR file {self.name} - try to delete local TAR")

        success = try_remove_file_clean_dirs(tar_path)

        if not success and not force_delete:
            logger.error(
                f"Clean TAR file {self.name} - failed - could not delete local TAR")
            return False
        elif success:
            logger.info(
                f"Clean TAR file {self.name} - try to delete local TAR - success")

        if not delete_obj:
            logger.info(
                f"Clean TAR file {self.name} - Alter database object")
            self.local_storage = False
            self.save()

        return True

    elif not self.local_storage and delete_obj and force_delete:
        if not all(self.files.values_list("local_storage", flat=True)):
            logger.error(
                f"{self.name}: Some files contained in this TAR are no longer stored locally. The remote TAR cannot be deleted.")
            return False
        self.files.all().update(archived=False)
        ssh_client = self.archive.init_ssh_client()
        ssh_connect_success = ssh_client.connect_to_ssh()
        if not ssh_connect_success:
            return False
        remote_path = posixjoin(self.path, self.name + ".tar.gz")
        status_code, stdout, stderr = ssh_client.send_ssh_command(
            f"rm {remote_path}")
        if status_code != 0:
            remote_path = posixjoin(self.path, self.name)
            status_code, stdout, stderr = ssh_client.send_ssh_command(
                f"rm {remote_path}")
        if status_code != 0:
            logger.info(f"{self.name}: Cannot remove remote TAR. {stdout}")
            return False
        else:
            logger.info(f"{self.name}: Remote TAR removed.")
            status_code, stdout, stderr = ssh_client.send_ssh_command(
                f"find {self.path} -type d -empty -delete")
            return True
    else:
        return False</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="archiving.models.pre_remove_tar" class="doc doc-heading">
            <code class="highlight language-python">pre_remove_tar(sender, instance, **kwargs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Signal handler to clean up TAR file storage before deleting the TarFile instance.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="Exception">Exception</span></code>
              –
              <div class="doc-md-description">
                <p>If cleanup fails.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>archiving\models.py</code></summary>
              <pre class="highlight"><code class="language-python">@receiver(pre_delete, sender=TarFile)
def pre_remove_tar(sender, instance: "TarFile", **kwargs) -&gt; None:
    """
    Signal handler to clean up TAR file storage before deleting the TarFile instance.

    Raises:
        Exception: If cleanup fails.
    """
    success = instance.clean_tar(True)
    if not success:
        raise Exception(f"Unable to remove TAR file {instance.name}")</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../functions/" class="btn btn-neutral float-left" title="functions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tar_functions/" class="btn btn-neutral float-right" title="tar_functions">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../functions/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tar_functions/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>

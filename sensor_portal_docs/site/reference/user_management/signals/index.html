<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>signals - ARISE MDS sensor portal help</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "signals";
        var mkdocs_page_input_path = "reference\\user_management\\signals.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> ARISE MDS sensor portal help
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../about/">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Data structure</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/project/">Project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/device/">Device</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/deployment/">Deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/datafile/">Datafile</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Detail</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/">Index</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/site/">Site</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datatype/">DataType</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/project/">Project</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/devicemodel/">DeviceModel</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/device/">Device</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/deployment/">Deployment</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datafile/">DataFile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/projectjob/">ProjectJob</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/taxon/">Taxon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/observation/">Observation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datapackage/">DataPackage</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For developers</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/data_handlers/">Data handlers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/generic_jobs/">Generic jobs</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Code Reference</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../ai_integration/">ai_integration</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../ai_integration/tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../archiving/">archiving</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/bagit_functions/">bagit_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/functions/">functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/tar_functions/">tar_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../camtrap_dp_export/">camtrap_dp_export</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/querysets/">querysets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_handlers/">data_handlers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/base_data_handler_class/">base_data_handler_class</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/functions/">functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/post_upload_task_handler/">post_upload_task_handler</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_models/">data_models</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/file_handling_functions/">file_handling_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/general_functions/">general_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/job_handling_functions/">job_handling_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/plotting_functions/">plotting_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/signals/">signals</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/validators/">validators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_models/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_packages/">data_packages</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/create_zip_functions/">create_zip_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../external_storage_import/">external_storage_import</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observation_editor/">observation_editor</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/GBIF_functions/">GBIF_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="../">user_management</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../serializers/">serializers</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">signals</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../views/">views</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/">utils</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/api_renderer/">api_renderer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/email/">email</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/general/">general</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/paginators/">paginators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/perm_functions/">perm_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/querysets/">querysets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/ssh_client/">ssh_client</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/task_functions/">task_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/test_functions/">test_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/validators/">validators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/views/">views</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For admin</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../admin/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../admin/permissions/">Permissions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../admin/models/">Admin only models</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">ARISE MDS sensor portal help</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">For developers</li>
          <li class="breadcrumb-item">Code Reference</li>
          <li class="breadcrumb-item"><a href="../">user_management</a></li>
      <li class="breadcrumb-item active">signals</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="user_management.signals"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="user_management.signals.check_device_user_is_manager" class="doc doc-heading">
            <code class="highlight language-python">check_device_user_is_manager(sender, instance, created, **kwargs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Ensures that the DeviceUser is added as a manager of the device after save.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sender</code></b>
                  (<code><span title="type">type</span></code>)
              –
              <div class="doc-md-description">
                <p>The model class sending the signal.</p>
              </div>
            </li>
            <li>
              <b><code>instance</code></b>
                  (<code><a class="autorefs autorefs-internal" title="DeviceUser (user_management.models.DeviceUser)" href="../models/#user_management.models.DeviceUser">DeviceUser</a></code>)
              –
              <div class="doc-md-description">
                <p>The instance being saved.</p>
              </div>
            </li>
            <li>
              <b><code>created</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>Whether this instance was created.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>user_management\signals.py</code></summary>
              <pre class="highlight"><code class="language-python">@receiver(post_save, sender=DeviceUser)
def check_device_user_is_manager(sender: type, instance: DeviceUser, created: bool, **kwargs: Any) -&gt; None:
    """
    Ensures that the DeviceUser is added as a manager of the device after save.

    Args:
        sender (type): The model class sending the signal.
        instance (DeviceUser): The instance being saved.
        created (bool): Whether this instance was created.
        **kwargs: Additional keyword arguments.
    """
    if not instance.device.managers.all().filter(pk=instance.pk).exists():
        instance.device.managers.add(instance)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="user_management.signals.create_user_token" class="doc doc-heading">
            <code class="highlight language-python">create_user_token(sender, instance, created, **kwargs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Signal handler to create an auth token upon creation of a User or DeviceUser.
- For DeviceUser, sets password to token key if device password is not set.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sender</code></b>
                  (<code><span title="type">type</span></code>)
              –
              <div class="doc-md-description">
                <p>The model class sending the signal.</p>
              </div>
            </li>
            <li>
              <b><code>instance</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>The instance being saved.</p>
              </div>
            </li>
            <li>
              <b><code>created</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>Whether this instance was created.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>user_management\signals.py</code></summary>
              <pre class="highlight"><code class="language-python">@receiver(post_save, sender=DeviceUser)
@receiver(post_save, sender=User)
def create_user_token(sender: type, instance: Any, created: bool, **kwargs: Any) -&gt; None:
    """
    Signal handler to create an auth token upon creation of a User or DeviceUser.
    - For DeviceUser, sets password to token key if device password is not set.

    Args:
        sender (type): The model class sending the signal.
        instance: The instance being saved.
        created (bool): Whether this instance was created.
        **kwargs: Additional keyword arguments.
    """
    if created:
        newtoken = Token(user=instance)
        if isinstance(instance, DeviceUser):
            if (instance.device.password is None) or (instance.device.password != ""):
                instance.password = newtoken.key
        newtoken.save()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="user_management.signals.on_change" class="doc doc-heading">
            <code class="highlight language-python">on_change(sender, instance, **kwargs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Signal handler for pre-save event on User model.
- Sends registration confirmation to new users.
- Notifies staff on new registrations.
- Sends activation/deactivation emails.
- Notifies users of password changes and updates device user passwords accordingly.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sender</code></b>
                  (<code><span title="type">type</span></code>)
              –
              <div class="doc-md-description">
                <p>The model class sending the signal.</p>
              </div>
            </li>
            <li>
              <b><code>instance</code></b>
                  (<code><a class="autorefs autorefs-internal" title="User (user_management.models.User)" href="../models/#user_management.models.User">User</a></code>)
              –
              <div class="doc-md-description">
                <p>The instance being saved.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>user_management\signals.py</code></summary>
              <pre class="highlight"><code class="language-python">@receiver(pre_save, sender=User)
def on_change(sender: type, instance: User, **kwargs: Any) -&gt; None:
    """
    Signal handler for pre-save event on User model.
    - Sends registration confirmation to new users.
    - Notifies staff on new registrations.
    - Sends activation/deactivation emails.
    - Notifies users of password changes and updates device user passwords accordingly.

    Args:
        sender (type): The model class sending the signal.
        instance (User): The instance being saved.
        **kwargs: Additional keyword arguments.
    """
    from utils.email import send_email_to_user, send_email_to_users

    if instance.id is None:  # new object will be created

        # send email confirming registration
        send_email_to_user(
            instance,
            f"Thanks for registering with {Site.objects.get_current().name}",
            f"""You have succesfully registered with {Site.objects.get_current().name} \n
            A member of staff will activate your account after review. \n
            You will receive an email when you account is activated."""
        )
        # send email alerting staff of registration
        send_email_to_users(
            User.objects.filter(is_staff=True),
            f"{instance.username} registered with {Site.objects.get_current().name}",
            f"""{instance.first_name} {instance.last_name} registered with {Site.objects.get_current().name} \n
            Their account will need to be activated after review. \n
            """
        )
    else:
        previous: User = User.objects.get(id=instance.id)
        if previous.is_active != instance.is_active:  # field will be updated
            if instance.is_active:
                # Send email alerting user to their account
                send_email_to_user(
                    instance,
                    f"Thanks for registering with {Site.objects.get_current().name}",
                    f"""Your account at {Site.objects.get_current().name} has been activated \n
                 Note that you may still need to be given additional permissions."""
                )
            else:
                # send email saying user account is deactivated?
                send_email_to_user(
                    instance,
                    f"Your account at {Site.objects.get_current().name}",
                    f"""Your account at {Site.objects.get_current().name} has been deactivated \n
                 If you feel this was an error, please contact your system administrator."""
                )
                pass

        if previous.password != instance.password:
            if instance.is_active:
                # Send email alerting user their password was changed
                send_email_to_user(
                    instance,
                    f"{Site.objects.get_current().name} - Password was changed",
                    f"""Your account at {Site.objects.get_current().name} has had its password changed. \n
                 If you did not request this password change, contact your system administrator immediately."""
                )
                # Set a users owned devices device users password to be their new password
                DeviceUser.objects.filter(
                    device__in=instance.owned_devices.all(),
                    password=previous.password
                ).update(password=instance.password)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="user_management.signals.password_reset_token_created" class="doc doc-heading">
            <code class="highlight language-python">password_reset_token_created(sender, instance, reset_password_token, *args, **kwargs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Handles password reset tokens.
When a token is created, an e-mail is sent to the user.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sender</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>View Class that sent the signal.</p>
              </div>
            </li>
            <li>
              <b><code>instance</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>View Instance that sent the signal.</p>
              </div>
            </li>
            <li>
              <b><code>reset_password_token</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>Token Model Object.</p>
              </div>
            </li>
            <li>
              <b><code>*args</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>()</code>
)
              –
              <div class="doc-md-description">
                <p>Additional positional arguments.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>user_management\signals.py</code></summary>
              <pre class="highlight"><code class="language-python">@receiver(reset_password_token_created)
def password_reset_token_created(sender: Any, instance: Any, reset_password_token: Any, *args: Any, **kwargs: Any) -&gt; None:
    """
    Handles password reset tokens.
    When a token is created, an e-mail is sent to the user.

    Args:
        sender: View Class that sent the signal.
        instance: View Instance that sent the signal.
        reset_password_token: Token Model Object.
        *args: Additional positional arguments.
        **kwargs: Additional keyword arguments.
    """

    from utils.email import send_email_to_user

    logger.info("Password reset token created", sender)
    # send an e-mail to the user
    context = {
        'current_user': reset_password_token.user,
        'username': reset_password_token.user.username,
        'email': reset_password_token.user.email,
        'reset_password_url': f"{Site.objects.get_current().domain}/reset-password/confirm/?token={reset_password_token.key}"
    }

    # render email text
    email_html_message = render_to_string(
        'user_reset_password.html', context)

    send_email_to_user(
        reset_password_token.user,
        f"Password Reset for {reset_password_token.user.username}",
        email_html_message
    )</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="user_management.signals.post_save_device" class="doc doc-heading">
            <code class="highlight language-python">post_save_device(sender, instance, created, **kwargs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Signal handler for post-save event on Device model.
- Creates a DeviceUser for the device if one does not exist.
- Ensures the DeviceUser is set as a manager.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sender</code></b>
                  (<code><span title="type">type</span></code>)
              –
              <div class="doc-md-description">
                <p>The model class sending the signal.</p>
              </div>
            </li>
            <li>
              <b><code>instance</code></b>
                  (<code><a class="autorefs autorefs-internal" title="Device (data_models.models.Device)" href="../../data_models/models/#data_models.models.Device">Device</a></code>)
              –
              <div class="doc-md-description">
                <p>The Device instance being saved.</p>
              </div>
            </li>
            <li>
              <b><code>created</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>Whether the instance was created.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>user_management\signals.py</code></summary>
              <pre class="highlight"><code class="language-python">@receiver(post_save, sender=Device)
def post_save_device(sender: type, instance: Device, created: bool, **kwargs: Any) -&gt; None:
    """
    Signal handler for post-save event on Device model.
    - Creates a DeviceUser for the device if one does not exist.
    - Ensures the DeviceUser is set as a manager.

    Args:
        sender (type): The model class sending the signal.
        instance (Device): The Device instance being saved.
        created (bool): Whether the instance was created.
        **kwargs: Additional keyword arguments.
    """
    add_device_user = False
    if created:
        add_device_user = True
    else:
        try:
            device_user = instance.device_user
        except ObjectDoesNotExist:
            add_device_user = True

    if add_device_user:
        user_name = f"{instance.device_ID}_user"
        if (instance.username is not None) and (instance.username != ":"):
            user_name = instance.username
        device_user = DeviceUser(
            username=user_name,
            device=instance,
            is_active=True
        )
        # if (instance.password is not None) and (instance.password != ""):
        #     device_user.password = instance.password
        if instance.owner:
            device_user.email = instance.owner.email
            if (instance.password is not None) and (instance.password != ""):
                # Set device user password to owner password
                device_user.password = instance.owner.password
        device_user.save()

    # always make sure device user as a manager
    instance.managers.add(device_user)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="user_management.signals.pre_user_save" class="doc doc-heading">
            <code class="highlight language-python">pre_user_save(sender, instance, **kwargs)</code>

</h2>


    <div class="doc doc-contents ">

        <p>Signal handler to ensure is_active is set to True:
- For DeviceUser, always set is_active to True.
- For User, set is_active to True if instance is a superuser.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>sender</code></b>
                  (<code><span title="type">type</span></code>)
              –
              <div class="doc-md-description">
                <p>The model class sending the signal.</p>
              </div>
            </li>
            <li>
              <b><code>instance</code></b>
                  (<code><span title="typing.Any">Any</span></code>)
              –
              <div class="doc-md-description">
                <p>The instance being saved.</p>
              </div>
            </li>
            <li>
              <b><code>**kwargs</code></b>
                  (<code><span title="typing.Any">Any</span></code>, default:
                      <code>{}</code>
)
              –
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>user_management\signals.py</code></summary>
              <pre class="highlight"><code class="language-python">@receiver(pre_save, sender=DeviceUser)
@receiver(pre_save, sender=User)
def pre_user_save(sender: type, instance: Any, **kwargs: Any) -&gt; None:
    """
    Signal handler to ensure is_active is set to True:
    - For DeviceUser, always set is_active to True.
    - For User, set is_active to True if instance is a superuser.

    Args:
        sender (type): The model class sending the signal.
        instance: The instance being saved.
        **kwargs: Additional keyword arguments.
    """
    if isinstance(instance, DeviceUser):
        instance.is_active = True
    elif hasattr(instance, 'is_superuser') and instance.is_superuser:
        instance.is_active = True</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../serializers/" class="btn btn-neutral float-left" title="serializers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../views/" class="btn btn-neutral float-right" title="views">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../serializers/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../views/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>

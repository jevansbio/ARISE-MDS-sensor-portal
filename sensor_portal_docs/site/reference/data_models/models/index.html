<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>models - ARISE MDS sensor portal help</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "models";
        var mkdocs_page_input_path = "reference\\data_models\\models.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> ARISE MDS sensor portal help
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../about/">About</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Data structure</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/project/">Project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/device/">Device</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/deployment/">Deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../structure/datafile/">Datafile</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Model detail</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/site/">Site</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datatype/">DataType</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/project/">Project</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/devicemodel/">DeviceModel</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/device/">Device</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/deployment/">Deployment</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datafile/">DataFile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/taxon/">Taxon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/observation/">Observation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../structure/detail/datapackage/">DataPackage</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/">Index</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/arise_mds_api_examples/">Examples</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../api/upload_data_workflow/">Upload example</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For developers</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/data_handlers/">Data handlers</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../developers/generic_jobs/">Generic jobs</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Code Reference</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../ai_integration/">ai_integration</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../ai_integration/tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../archiving/">archiving</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/bagit_functions/">bagit_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/functions/">functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/tar_functions/">tar_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../archiving/tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../camtrap_dp_export/">camtrap_dp_export</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/querysets/">querysets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../camtrap_dp_export/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_handlers/">data_handlers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/base_data_handler_class/">base_data_handler_class</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/functions/">functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/post_upload_task_handler/">post_upload_task_handler</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_handlers/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="../">data_models</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../file_handling_functions/">file_handling_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../general_functions/">general_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../job_handling_functions/">job_handling_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="#">models</a>
    <ul class="current">
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../plotting_functions/">plotting_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../signals/">signals</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../validators/">validators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../data_packages/">data_packages</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/create_zip_functions/">create_zip_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../data_packages/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../dsi/">dsi</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../dsi/api_client/">api_client</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../dsi/api_functions/">api_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../dsi/tasks/">tasks</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../external_storage_import/">external_storage_import</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../external_storage_import/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../observation_editor/">observation_editor</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/GBIF_functions/">GBIF_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/metadata_functions/">metadata_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/tasks/">tasks</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../observation_editor/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../user_management/">user_management</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/signals/">signals</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/views/">views</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../user_management/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../utils/">utils</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/api_renderer/">api_renderer</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/email/">email</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/filtersets/">filtersets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/general/">general</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/models/">models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/paginators/">paginators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/perm_functions/">perm_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/querysets/">querysets</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/rules/">rules</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/serializers/">serializers</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/ssh_client/">ssh_client</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/task_functions/">task_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/test_functions/">test_functions</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/validators/">validators</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/views/">views</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../utils/viewsets/">viewsets</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >uva_jobs</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../uva_jobs/tasks/">tasks</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">For admin</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../admin/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../UVA/UVA/">UVA management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../admin/permissions/">Permissions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Admin only models details</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/projectjob/">Project Job</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/data_storage_input/">Data Storage input</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/archive/">Archive</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../admin/detail/tarfile/">TAR file</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">ARISE MDS sensor portal help</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">For developers</li>
          <li class="breadcrumb-item">Code Reference</li>
          <li class="breadcrumb-item"><a href="../">data_models</a></li>
      <li class="breadcrumb-item active">models</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<a id="data_models.models"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="data_models.models.DataFile" class="doc doc-heading">
            <code>DataFile</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Represents a data file associated with a deployment.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class DataFile(BaseModel):
    """
    Represents a data file associated with a deployment.
    """
    deployment = models.ForeignKey(
        Deployment, on_delete=models.CASCADE, related_name="files", db_index=True, help_text="Deployment to which this datafile is linked.")
    file_type = models.ForeignKey(
        DataType, models.PROTECT, related_name="files", null=True, default=None, db_index=True, help_text="Data type of file.")
    file_name = models.CharField(
        max_length=150, unique=True, db_index=True, help_text="File name.")
    file_size = FileSizeField(help_text="Size of file in bytes.")
    file_format = models.CharField(max_length=10, help_text="File extension.")
    upload_dt = models.DateTimeField(
        default=djtimezone.now, help_text="Datetime at which the file was uploaded.")
    recording_dt = models.DateTimeField(
        null=True, db_index=True, help_text="Datetime at which the file was recorded.")
    path = models.CharField(max_length=500, help_text="Relative path.")
    local_path = models.CharField(max_length=500, blank=True,
                                  help_text="Absolute file location on local storage, from which path is relative.")
    extra_data = models.JSONField(
        default=dict, blank=True, help_text="Extra data that does not fit in existing columns.")
    linked_files = models.JSONField(
        default=dict, blank=True, help_text="Linked files, such as alternative representations of this file.")
    thumb_url = models.CharField(
        max_length=500, null=True, blank=True, help_text="Thumbnail URL.")
    local_storage = models.BooleanField(
        default=True, db_index=True, help_text="Is the file available on local storage?")
    archived = models.BooleanField(
        default=False, help_text="Has the file been archived?")
    tar_file = models.ForeignKey(
        TarFile, on_delete=models.SET_NULL, blank=True, null=True, related_name="files",
        help_text="TAR file containing this file.")
    favourite_of = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="favourites", help_text="Users who have favourited this file.")
    do_not_remove = models.BooleanField(
        default=False, help_text="If True, this file will not be removed during cleaning.")
    original_name = models.CharField(
        max_length=100, blank=True, null=True, help_text="Original name of this file.")
    file_url = models.CharField(
        max_length=500, null=True, blank=True, help_text="URL of this file")
    tag = models.CharField(max_length=250, null=True,
                           blank=True, db_index=True, help_text="Additional identifying tag of this file.")
    has_human = models.BooleanField(
        default=False, db_index=True, help_text="True if this image has been annotated with a human.")

    objects = DataFileQuerySet.as_manager()

    class Meta:
        indexes = [
            GinIndex(
                OpClass(Upper('tag'), name='gin_trgm_ops'),
                name='upper_tag_gin_idx',
            ),
            GinIndex(
                OpClass(Upper('file_name'), name='gin_trgm_ops'),
                name='upper_file_name_gin_idx',
            )
        ]

    def __str__(self):
        return f"{self.file_name}{self.file_format}"

    def get_absolute_url(self):
        return f"/datafiles/{self.pk}"

    def add_favourite(self, user: "User") -&gt; None:
        """
        Add a user to this file's favourites.
        """
        self.favourite_of.add(user)
        self.save()

    def remove_favourite(self, user: "User") -&gt; None:
        """
        Remove a user from this file's favourites.
        """
        self.favourite_of.remove(user)
        self.save()

    def full_path(self):
        """
        Returns the full path to this file on local storage.
        """
        return os.path.join(self.local_path, self.path, f"{self.file_name}{self.file_format}")

    def thumb_path(self):
        """
        Returns the path to the thumbnail version of this file.
        """
        return os.path.join(self.local_path, self.path, self.file_name+"_THUMB.jpg")

    def set_file_url(self):
        """
        Sets the file_url for this file using storage settings.
        """
        if self.local_storage:
            self.file_url = os.path.normpath(
                os.path.join(settings.FILE_STORAGE_URL, self.path,
                             (self.file_name + self.file_format))
            ).replace("\\", "/")
        else:
            self.file_url = None

    def set_linked_files_urls(self):
        """
        Set file URLs for each linked file.
        """
        for key in self.linked_files.keys():
            file_path = self.linked_files[key]["path"]
            rel_file_path = os.path.relpath(
                file_path, settings.FILE_STORAGE_ROOT)
            self.linked_files[key]["url"] = os.path.join(
                settings.FILE_STORAGE_URL, rel_file_path)

    def set_thumb_url(self, has_thumb: bool = True) -&gt; None:
        """
        Set the thumbnail URL for this file.
        """
        if has_thumb:
            self.thumb_url = os.path.normpath(os.path.join(
                settings.FILE_STORAGE_URL, self.path, self.file_name+"_THUMB.jpg"))
        else:
            self.thumb_url = None

    def check_human(self):
        """
        Checks for human observations and updates has_human accordingly.
        """
        old_has_human = self.has_human
        new_has_human = self.observations.filter(
            taxon__taxon_code=settings.HUMAN_TAXON_CODE).exists()
        if old_has_human != new_has_human:
            self.has_human = new_has_human
            self.save()
            self.deployment.set_thumb_url()
            self.deployment.save()

    def clean_file(self, delete_obj: bool = False, force_delete: bool = False) -&gt; bool:
        """
        Clean up this file and its associated resources.

        Args:
            delete_obj (bool): True if the object will be deleted from the database after cleaning.
            force_delete (bool): If True, force deletion/alteration even if file can't be deleted.

        Returns:
            bool: True if the file was successfully cleaned, False otherwise.
        """
        logger.info(
            f"Clean {self.file_name} - Delete object: {delete_obj} - Force delete:{force_delete}")
        if (delete_obj and self.archived) and not force_delete:
            logger.info(
                f"Clean {self.file_name} - Full delete failed - Archived file")
            return False
        if (self.do_not_remove or self.deployment_last_image.exists() or self.favourite_of.exists()) and (not delete_obj or force_delete):
            logger.info(f"Clean {self.file_name} - Failed - Protected file")
            return False
        if self.local_storage:
            logger.info(f"Clean {self.file_name} - Try to remove file")
            success = try_remove_file_clean_dirs(self.full_path())
            if not success and not force_delete:
                logger.error(
                    f"Clean {self.file_name} - Failed - Cannot delete local file")
                return False
            elif success:
                logger.info(
                    f"Clean {self.file_name} - Try to remove file - success")
            logger.info(f"Clean {self.file_name} - Try to remove thumbnail")
            if self.thumb_url is not None and self.thumb_url != "":
                thumb_path = self.thumb_path()
                success = try_remove_file_clean_dirs(thumb_path)
                if success:
                    logger.info(
                        f"Clean {self.file_name} - Try to remove thumbnail - success")
                else:
                    logger.info(
                        f"Clean {self.file_name} - Try to remove thumbnail - failed")
            for key, value in self.linked_files.items():
                extra_version_path = value["path"]
                logger.info(f"Clean {self.file_name} - Try to remove {key}")
                success = try_remove_file_clean_dirs(extra_version_path)
                if success:
                    logger.info(
                        f"Clean {self.file_name} - Try to remove {key} - success")
                else:
                    logger.info(
                        f"Clean {self.file_name} - Try to remove {key} - failed")
        if not delete_obj:
            logger.info(f"Clean {self.file_name} - Altering database")
            self.local_storage = False
            self.local_path = ""
            self.linked_files = {}
            self.set_thumb_url(False)
            self.save()
        return True

    def save(self, *args, **kwargs):
        """
        Assigns file_type from deployment if not set, sets file_url, then saves.
        """
        if self.file_type is None:
            self.file_type = self.deployment.device.type
        self.set_file_url()
        super().save(*args, **kwargs)

    def clean(self):
        """
        Validates that this file is within its deployment's date range.
        Raises ValidationError if invalid.
        """
        result, message = validators.data_file_in_deployment(
            self.recording_dt, self.deployment)
        if not result:
            raise ValidationError(message)
        super(DataFile, self).clean()</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.add_favourite" class="doc doc-heading">
            <code class="highlight language-python">add_favourite(user)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Add a user to this file's favourites.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def add_favourite(self, user: "User") -&gt; None:
    """
    Add a user to this file's favourites.
    """
    self.favourite_of.add(user)
    self.save()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.check_human" class="doc doc-heading">
            <code class="highlight language-python">check_human()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks for human observations and updates has_human accordingly.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_human(self):
    """
    Checks for human observations and updates has_human accordingly.
    """
    old_has_human = self.has_human
    new_has_human = self.observations.filter(
        taxon__taxon_code=settings.HUMAN_TAXON_CODE).exists()
    if old_has_human != new_has_human:
        self.has_human = new_has_human
        self.save()
        self.deployment.set_thumb_url()
        self.deployment.save()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.clean" class="doc doc-heading">
            <code class="highlight language-python">clean()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Validates that this file is within its deployment's date range.
Raises ValidationError if invalid.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def clean(self):
    """
    Validates that this file is within its deployment's date range.
    Raises ValidationError if invalid.
    """
    result, message = validators.data_file_in_deployment(
        self.recording_dt, self.deployment)
    if not result:
        raise ValidationError(message)
    super(DataFile, self).clean()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.clean_file" class="doc doc-heading">
            <code class="highlight language-python">clean_file(delete_obj=False, force_delete=False)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Clean up this file and its associated resources.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>delete_obj</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>True if the object will be deleted from the database after cleaning.</p>
              </div>
            </li>
            <li>
              <b><code>force_delete</code></b>
                  (<code><span title="bool">bool</span></code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>If True, force deletion/alteration even if file can't be deleted.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>bool</code></b>(                  <code><span title="bool">bool</span></code>
)              –
              <div class="doc-md-description">
                <p>True if the file was successfully cleaned, False otherwise.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def clean_file(self, delete_obj: bool = False, force_delete: bool = False) -&gt; bool:
    """
    Clean up this file and its associated resources.

    Args:
        delete_obj (bool): True if the object will be deleted from the database after cleaning.
        force_delete (bool): If True, force deletion/alteration even if file can't be deleted.

    Returns:
        bool: True if the file was successfully cleaned, False otherwise.
    """
    logger.info(
        f"Clean {self.file_name} - Delete object: {delete_obj} - Force delete:{force_delete}")
    if (delete_obj and self.archived) and not force_delete:
        logger.info(
            f"Clean {self.file_name} - Full delete failed - Archived file")
        return False
    if (self.do_not_remove or self.deployment_last_image.exists() or self.favourite_of.exists()) and (not delete_obj or force_delete):
        logger.info(f"Clean {self.file_name} - Failed - Protected file")
        return False
    if self.local_storage:
        logger.info(f"Clean {self.file_name} - Try to remove file")
        success = try_remove_file_clean_dirs(self.full_path())
        if not success and not force_delete:
            logger.error(
                f"Clean {self.file_name} - Failed - Cannot delete local file")
            return False
        elif success:
            logger.info(
                f"Clean {self.file_name} - Try to remove file - success")
        logger.info(f"Clean {self.file_name} - Try to remove thumbnail")
        if self.thumb_url is not None and self.thumb_url != "":
            thumb_path = self.thumb_path()
            success = try_remove_file_clean_dirs(thumb_path)
            if success:
                logger.info(
                    f"Clean {self.file_name} - Try to remove thumbnail - success")
            else:
                logger.info(
                    f"Clean {self.file_name} - Try to remove thumbnail - failed")
        for key, value in self.linked_files.items():
            extra_version_path = value["path"]
            logger.info(f"Clean {self.file_name} - Try to remove {key}")
            success = try_remove_file_clean_dirs(extra_version_path)
            if success:
                logger.info(
                    f"Clean {self.file_name} - Try to remove {key} - success")
            else:
                logger.info(
                    f"Clean {self.file_name} - Try to remove {key} - failed")
    if not delete_obj:
        logger.info(f"Clean {self.file_name} - Altering database")
        self.local_storage = False
        self.local_path = ""
        self.linked_files = {}
        self.set_thumb_url(False)
        self.save()
    return True</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.full_path" class="doc doc-heading">
            <code class="highlight language-python">full_path()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the full path to this file on local storage.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def full_path(self):
    """
    Returns the full path to this file on local storage.
    """
    return os.path.join(self.local_path, self.path, f"{self.file_name}{self.file_format}")</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.remove_favourite" class="doc doc-heading">
            <code class="highlight language-python">remove_favourite(user)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Remove a user from this file's favourites.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def remove_favourite(self, user: "User") -&gt; None:
    """
    Remove a user from this file's favourites.
    """
    self.favourite_of.remove(user)
    self.save()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.save" class="doc doc-heading">
            <code class="highlight language-python">save(*args, **kwargs)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Assigns file_type from deployment if not set, sets file_url, then saves.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def save(self, *args, **kwargs):
    """
    Assigns file_type from deployment if not set, sets file_url, then saves.
    """
    if self.file_type is None:
        self.file_type = self.deployment.device.type
    self.set_file_url()
    super().save(*args, **kwargs)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.set_file_url" class="doc doc-heading">
            <code class="highlight language-python">set_file_url()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Sets the file_url for this file using storage settings.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def set_file_url(self):
    """
    Sets the file_url for this file using storage settings.
    """
    if self.local_storage:
        self.file_url = os.path.normpath(
            os.path.join(settings.FILE_STORAGE_URL, self.path,
                         (self.file_name + self.file_format))
        ).replace("\\", "/")
    else:
        self.file_url = None</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.set_linked_files_urls" class="doc doc-heading">
            <code class="highlight language-python">set_linked_files_urls()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Set file URLs for each linked file.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def set_linked_files_urls(self):
    """
    Set file URLs for each linked file.
    """
    for key in self.linked_files.keys():
        file_path = self.linked_files[key]["path"]
        rel_file_path = os.path.relpath(
            file_path, settings.FILE_STORAGE_ROOT)
        self.linked_files[key]["url"] = os.path.join(
            settings.FILE_STORAGE_URL, rel_file_path)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.set_thumb_url" class="doc doc-heading">
            <code class="highlight language-python">set_thumb_url(has_thumb=True)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Set the thumbnail URL for this file.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def set_thumb_url(self, has_thumb: bool = True) -&gt; None:
    """
    Set the thumbnail URL for this file.
    """
    if has_thumb:
        self.thumb_url = os.path.normpath(os.path.join(
            settings.FILE_STORAGE_URL, self.path, self.file_name+"_THUMB.jpg"))
    else:
        self.thumb_url = None</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.DataFile.thumb_path" class="doc doc-heading">
            <code class="highlight language-python">thumb_path()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the path to the thumbnail version of this file.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def thumb_path(self):
    """
    Returns the path to the thumbnail version of this file.
    """
    return os.path.join(self.local_path, self.path, self.file_name+"_THUMB.jpg")</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.DataFileQuerySet" class="doc doc-heading">
            <code>DataFileQuerySet</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="ApproximateCountQuerySet (utils.querysets.ApproximateCountQuerySet)" href="../../utils/querysets/#utils.querysets.ApproximateCountQuerySet">ApproximateCountQuerySet</a></code></p>


        <p>Custom QuerySet for DataFile, providing path annotations and statistics.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class DataFileQuerySet(ApproximateCountQuerySet):
    """
    Custom QuerySet for DataFile, providing path annotations and statistics.
    """

    def full_paths(self):
        self = self.relative_paths()
        return self.annotate(full_path=Concat(F('local_path'), Value(os.sep), F('relative_path')))

    def relative_paths(self):
        self = self.full_names()
        return self.annotate(relative_path=Concat(F('path'), Value(os.sep), F('full_name')))

    def full_names(self):
        return self.annotate(full_name=Concat(F('file_name'), F('file_format')))

    def file_size_unit(self, unit=""):
        total_file_size = self.aggregate(total_file_size=Sum("file_size"))[
            "total_file_size"]
        converted_file_size = convert_unit(total_file_size, unit)
        return converted_file_size

    def file_count(self):
        return self.aggregate(total_file_size=Cast(Sum("file_size"), models.FloatField())/Cast(Value(1024*1024*1024), models.FloatField()),
                              object_n=Count("pk"),
                              archived_file_n=Sum(Case(When(local_storage=False, archived=True, then=Value(1)), default=Value(0))))

    def min_date(self):
        return self.aggregate(min_date=Min("recording_dt"))["min_date"]

    def max_date(self):
        return self.aggregate(max_date=Max("recording_dt"))["max_date"]

    def device_type(self):
        return self.annotate(device_type=F('deployment__device__type__name'))</code></pre>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.DataType" class="doc doc-heading">
            <code>DataType</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Describes a type of data, including its name, color, and optional icon.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class DataType(BaseModel):
    """
    Describes a type of data, including its name, color, and optional icon.
    """
    name = models.CharField(max_length=20, help_text="Name of data type.")
    colour = ColorField(default="#FFFFFF",
                        help_text="Colour to use for this data type.")
    symbol = IconField(
        blank=True, help_text="Symbol to use for this data type.")

    def __str__(self):
        return self.name</code></pre>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.Deployment" class="doc doc-heading">
            <code>Deployment</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Records a deployment of a device to a site, within a project.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class Deployment(BaseModel):
    """
    Records a deployment of a device to a site, within a project.
    """
    deployment_device_ID = models.CharField(
        max_length=110, blank=True, editable=False, unique=True,
        help_text="Unique identifier combining 'deployment_ID', 'device_type' and 'device_n'.")
    deployment_ID = models.CharField(
        max_length=80, help_text="An identifier for a deployment.")
    device_type = models.ForeignKey(
        DataType, models.PROTECT, related_name="deployments", null=True, db_index=True, help_text="Primary data type of deployment.")
    device_n = models.IntegerField(default=1,
                                   help_text="Numeric suffix of deployment, allowing for multiple deployments to share the same 'deployment_ID' and 'device_type'.")
    deployment_start = models.DateTimeField(
        default=djtimezone.now, help_text="Start datetime of deployment.")
    deployment_end = models.DateTimeField(
        blank=True, null=True, help_text="End time of deployment. Can be NULL if deployment is ongoing.")
    device = models.ForeignKey(
        Device, on_delete=models.PROTECT, related_name="deployments", db_index=True, help_text="Device of which this is a deployment.")
    site = models.ForeignKey(Site, models.PROTECT, related_name="deployments",
                             help_text="Site at which this deployment is placed.")
    project = models.ManyToManyField(
        Project, related_name="deployments", blank=True, db_index=True, help_text="Projects to which this deployment is attached.")
    latitude = models.DecimalField(
        max_digits=8, decimal_places=6, blank=True, null=True, help_text="Latitude at which this deployment is placed.")
    longitude = models.DecimalField(
        max_digits=8, decimal_places=6, blank=True, null=True, help_text="Longitude at which this deployment is placed.")
    point = gis_models.PointField(
        blank=True, null=True, spatial_index=True, help_text="Spatial point representing this deployment."
    )
    extra_data = models.JSONField(
        default=dict, blank=True, help_text="Extra data that does not fit in other fields.")
    is_active = models.BooleanField(
        default=True, help_text="Is the deployment currently active? Checked every hour.")
    time_zone = TimeZoneField(
        use_pytz=True, default=settings.TIME_ZONE, help_text="Time zone for this deployment.")

    owner = models.ForeignKey(settings.AUTH_USER_MODEL, blank=True, related_name="owned_deployments",
                              on_delete=models.SET_NULL, null=True, db_index=True, help_text="Owner of deployment.")
    managers = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="managed_deployments",  db_index=True,
        help_text="Managers of deployment.")
    viewers = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="viewable_deployments", db_index=True,
        help_text="Annotators of deployment.")
    annotators = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="annotatable_deployments", db_index=True,
        help_text="Viewers of deployment.")

    combo_project = models.CharField(
        max_length=100, blank=True, null=True, editable=False, help_text="String combining all projects.")
    last_image = models.ForeignKey("DataFile", blank=True, on_delete=models.SET_NULL, null=True, editable=False,
                                   related_name="deployment_last_image", help_text="Last image (if any) linked to this deployment.")
    thumb_url = models.CharField(
        max_length=500, null=True, blank=True, editable=False, help_text="Deployment thumbnail URL.")

    def get_absolute_url(self):
        """
        Returns the URL to this deployment detail.
        """
        return f"/deployments/{self.pk}"

    def __str__(self):
        return self.deployment_device_ID

    def clean(self):
        """
        Validates deployment start/end time and checks for overlapping deployments.
        Raises ValidationError on failure.
        """
        result, message = validators.deployment_start_time_after_end_time(
            self.deployment_start, self.deployment_end)
        if not result:
            raise ValidationError(message)
        result, message = validators.deployment_check_overlap(
            self.deployment_start, self.deployment_end, self.device, self.pk)
        if not result:
            raise ValidationError(message)
        super(Deployment, self).clean()

    def save(self, *args, **kwargs):
        """
        Sets deployment_device_ID, is_active, device_type, point, and combo_project before saving.
        """
        self.deployment_device_ID = f"{self.deployment_ID}_{self.device.type.name}_{self.device_n}"
        self.is_active = self.check_active()
        if self.device_type is None:
            self.device_type = self.device.type
        if self.longitude and self.latitude:
            self.point = Point(float(self.longitude),
                               float(self.latitude), srid=4326)
        elif (self.longitude is None and self.latitude is None) and self.point is not None:
            self.longitude, self.latitude = self.point.coords
        else:
            self.point = None
        if self.id:
            self.combo_project = self.get_combo_project()
        super().save(*args, **kwargs)
        self.get_permissions()

    def get_permissions(self):
        """
        Propagates permissions from device and project to this deployment.
        """
        logger.info(
            f"Set deployment {self} permissions from device and projects")
        all_managers = self.device.managers.all().union(
            get_user_model().objects.filter(pk__in=self.project.all().values_list('managers__pk', flat=True)))
        self.managers.set(all_managers)
        all_annotators = self.device.annotators.all().union(
            get_user_model().objects.filter(pk__in=self.project.all().values_list('annotators__pk', flat=True)))
        self.annotators.set(all_annotators)
        all_viewers = self.device.viewers.all().union(
            get_user_model().objects.filter(pk__in=self.project.all().values_list('viewers__pk', flat=True)))
        self.viewers.set(all_viewers)
        if self.owner:
            self.managers.add(self.owner)
            self.annotators.add(self.owner)
            self.viewers.add(self.owner)

    def get_combo_project(self):
        """
        Returns a single space-separated string of sorted project IDs for this deployment.
        """
        if self.project.all().exists():
            all_proj_id = list(
                self.project.all().values_list("project_ID", flat=True))
            all_proj_id.sort()
            return " ".join(all_proj_id)
        else:
            return ""

    def check_active(self):
        """
        Returns True if the deployment is currently active, otherwise False.
        """
        self.deployment_start = check_dt(self.deployment_start)
        if self.deployment_end:
            self.deployment_end = check_dt(self.deployment_end)
        if self.deployment_start &lt;= djtimezone.now():
            if self.deployment_end is None or self.deployment_end &gt;= djtimezone.now():
                return True
        return False

    def check_dates(self, dt_list: List[datetime]) -&gt; List[bool]:
        """
        Checks if datetimes in dt_list fall within the deployment's period.

        Args:
            dt_list (List[datetime]): List of datetimes to check.

        Returns:
            List[bool]: True for each value in dt_list that is within the deployment, else False.
        """
        result_list = []
        for dt in dt_list:
            dt = check_dt(dt, self.time_zone)
            result_list.append((dt &gt;= self.deployment_start)
                               and ((self.deployment_end is None) or (dt &lt;= self.deployment_end)))
        return result_list

    def set_thumb_url(self):
        """
        Sets thumb_url and last_image based on latest file that has a thumbnail and no human involvement.
        """
        last_file = self.files.filter(
            thumb_url__isnull=False, has_human=False).order_by('recording_dt').last()
        if last_file is not None:
            self.last_image = last_file
            self.thumb_url = last_file.thumb_url
        else:
            self.last_image = None
            self.thumb_url = None</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.check_active" class="doc doc-heading">
            <code class="highlight language-python">check_active()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns True if the deployment is currently active, otherwise False.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_active(self):
    """
    Returns True if the deployment is currently active, otherwise False.
    """
    self.deployment_start = check_dt(self.deployment_start)
    if self.deployment_end:
        self.deployment_end = check_dt(self.deployment_end)
    if self.deployment_start &lt;= djtimezone.now():
        if self.deployment_end is None or self.deployment_end &gt;= djtimezone.now():
            return True
    return False</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.check_dates" class="doc doc-heading">
            <code class="highlight language-python">check_dates(dt_list)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Checks if datetimes in dt_list fall within the deployment's period.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>dt_list</code></b>
                  (<code><span title="typing.List">List</span>[<span title="datetime.datetime">datetime</span>]</code>)
              –
              <div class="doc-md-description">
                <p>List of datetimes to check.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="bool">bool</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[bool]: True for each value in dt_list that is within the deployment, else False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_dates(self, dt_list: List[datetime]) -&gt; List[bool]:
    """
    Checks if datetimes in dt_list fall within the deployment's period.

    Args:
        dt_list (List[datetime]): List of datetimes to check.

    Returns:
        List[bool]: True for each value in dt_list that is within the deployment, else False.
    """
    result_list = []
    for dt in dt_list:
        dt = check_dt(dt, self.time_zone)
        result_list.append((dt &gt;= self.deployment_start)
                           and ((self.deployment_end is None) or (dt &lt;= self.deployment_end)))
    return result_list</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.clean" class="doc doc-heading">
            <code class="highlight language-python">clean()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Validates deployment start/end time and checks for overlapping deployments.
Raises ValidationError on failure.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def clean(self):
    """
    Validates deployment start/end time and checks for overlapping deployments.
    Raises ValidationError on failure.
    """
    result, message = validators.deployment_start_time_after_end_time(
        self.deployment_start, self.deployment_end)
    if not result:
        raise ValidationError(message)
    result, message = validators.deployment_check_overlap(
        self.deployment_start, self.deployment_end, self.device, self.pk)
    if not result:
        raise ValidationError(message)
    super(Deployment, self).clean()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.get_absolute_url" class="doc doc-heading">
            <code class="highlight language-python">get_absolute_url()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the URL to this deployment detail.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_absolute_url(self):
    """
    Returns the URL to this deployment detail.
    """
    return f"/deployments/{self.pk}"</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.get_combo_project" class="doc doc-heading">
            <code class="highlight language-python">get_combo_project()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns a single space-separated string of sorted project IDs for this deployment.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_combo_project(self):
    """
    Returns a single space-separated string of sorted project IDs for this deployment.
    """
    if self.project.all().exists():
        all_proj_id = list(
            self.project.all().values_list("project_ID", flat=True))
        all_proj_id.sort()
        return " ".join(all_proj_id)
    else:
        return ""</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.get_permissions" class="doc doc-heading">
            <code class="highlight language-python">get_permissions()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Propagates permissions from device and project to this deployment.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_permissions(self):
    """
    Propagates permissions from device and project to this deployment.
    """
    logger.info(
        f"Set deployment {self} permissions from device and projects")
    all_managers = self.device.managers.all().union(
        get_user_model().objects.filter(pk__in=self.project.all().values_list('managers__pk', flat=True)))
    self.managers.set(all_managers)
    all_annotators = self.device.annotators.all().union(
        get_user_model().objects.filter(pk__in=self.project.all().values_list('annotators__pk', flat=True)))
    self.annotators.set(all_annotators)
    all_viewers = self.device.viewers.all().union(
        get_user_model().objects.filter(pk__in=self.project.all().values_list('viewers__pk', flat=True)))
    self.viewers.set(all_viewers)
    if self.owner:
        self.managers.add(self.owner)
        self.annotators.add(self.owner)
        self.viewers.add(self.owner)</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.save" class="doc doc-heading">
            <code class="highlight language-python">save(*args, **kwargs)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Sets deployment_device_ID, is_active, device_type, point, and combo_project before saving.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def save(self, *args, **kwargs):
    """
    Sets deployment_device_ID, is_active, device_type, point, and combo_project before saving.
    """
    self.deployment_device_ID = f"{self.deployment_ID}_{self.device.type.name}_{self.device_n}"
    self.is_active = self.check_active()
    if self.device_type is None:
        self.device_type = self.device.type
    if self.longitude and self.latitude:
        self.point = Point(float(self.longitude),
                           float(self.latitude), srid=4326)
    elif (self.longitude is None and self.latitude is None) and self.point is not None:
        self.longitude, self.latitude = self.point.coords
    else:
        self.point = None
    if self.id:
        self.combo_project = self.get_combo_project()
    super().save(*args, **kwargs)
    self.get_permissions()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Deployment.set_thumb_url" class="doc doc-heading">
            <code class="highlight language-python">set_thumb_url()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Sets thumb_url and last_image based on latest file that has a thumbnail and no human involvement.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def set_thumb_url(self):
    """
    Sets thumb_url and last_image based on latest file that has a thumbnail and no human involvement.
    """
    last_file = self.files.filter(
        thumb_url__isnull=False, has_human=False).order_by('recording_dt').last()
    if last_file is not None:
        self.last_image = last_file
        self.thumb_url = last_file.thumb_url
    else:
        self.last_image = None
        self.thumb_url = None</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.Device" class="doc doc-heading">
            <code>Device</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Represents a physical device or sensor.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class Device(BaseModel):
    """
    Represents a physical device or sensor.
    """
    device_ID = models.CharField(
        max_length=20, unique=True, help_text="Unique identifier for device, such as a serial number.")
    name = models.CharField(max_length=50, blank=True,
                            help_text="Optional alternative name for device.")
    model = models.ForeignKey(
        DeviceModel, models.PROTECT, related_name="registered_devices", help_text="Device model.")
    type = models.ForeignKey(DataType, models.PROTECT,
                             related_name="devices", null=True, db_index=True)
    owner = models.ForeignKey(settings.AUTH_USER_MODEL, blank=True, related_name="owned_devices",
                              on_delete=models.SET_NULL, null=True, db_index=True, help_text="Device owner.")
    managers = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="managed_devices", db_index=True, help_text="Device managers.")
    viewers = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="viewable_devices", db_index=True, help_text="Device viewers.")
    annotators = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="annotatable_devices", db_index=True, help_text="Device annotators.")
    autoupdate = models.BooleanField(
        default=False, help_text="Is the device expected to autoupdate?")
    update_time = models.IntegerField(
        default=48, help_text="Hours between expected updates. Notify users after this time.")
    username = models.CharField(
        max_length=100, unique=True, null=True, blank=True, default=None, help_text="Device username for use with external storage.")
    password = EncryptedCharField(max_length=100, blank=True, null=True,
                                  help_text="Device password for use with external storage.")
    input_storage = models.ForeignKey(
        DataStorageInput, null=True, blank=True, related_name="linked_devices", on_delete=models.SET_NULL,
        help_text="External storage for device.")
    extra_data = models.JSONField(
        default=dict, blank=True, help_text="Extra data that doesn't fit in existing fields.")

    def is_active(self):
        """
        Returns True if the device has at least one active deployment.
        """
        if self.id:
            return self.deployments.filter(is_active=True).exists()
        return False

    def __str__(self):
        return self.device_ID

    def get_absolute_url(self):
        return f"/devices/{self.pk}"

    def save(self, *args, **kwargs):
        """
        Assigns the device type from the model if not explicitly set.
        """
        if not self.type:
            self.type = self.model.type
        super().save(*args, **kwargs)

    def clean(self):
        """
        Validates device type matches model type.
        """
        result, message = validators.device_check_type(self.type, self.model)
        if not result:
            raise ValidationError(message)
        super(Device, self).clean()

    def deployment_from_date(self, dt: datetime) -&gt; "Deployment":
        """
        Return the deployment for this device active at the given datetime.

        Args:
            dt (datetime): Datetime to check. If None, returns None.

        Returns:
            Deployment or None: The matching deployment, or None if ambiguous or not found.

        Raises:
            ObjectDoesNotExist: If no matching deployment found.
            MultipleObjectsReturned: If more than one deployment matches.
        """
        logger.info(
            f"Attempt to find deployment for device {self.device_ID} for {dt}")
        if dt is None:
            return None
        all_deploys = self.deployments.all()
        all_tz = all_deploys.values('time_zone', 'pk')
        all_tz = [{'time_zone': x.get(
            'time_zone', settings.TIME_ZONE), 'pk': x['pk']} for x in all_tz]
        all_dt = {x['pk']: check_dt(dt, x['time_zone']) for x in all_tz}
        whens = [When(pk=k, then=Value(v)) for k, v in all_dt.items()]
        all_deploys = all_deploys.annotate(
            dt=Case(*whens, output_field=DateTimeField(), default=Value(None)))
        all_deploys = all_deploys.annotate(deployment_end_indefinite=Case(
            When(deployment_end__isnull=True,
                 then=ExpressionWrapper(F('deployment_start') + timedelta(days=365 * 100), output_field=DateTimeField())),
            default=F('deployment_end')
        ))
        all_deploys = all_deploys.annotate(in_deployment=ExpressionWrapper(
            Q(Q(deployment_start__lte=F('dt')) &amp; Q(
                deployment_end_indefinite__gte=F('dt'))),
            output_field=BooleanField()))
        try:
            correct_deployment = all_deploys.get(in_deployment=True)
            return correct_deployment
        except (ObjectDoesNotExist, MultipleObjectsReturned):
            all_true_deployments = all_deploys.filter(in_deployment=True)
            logger.info(
                f"Error: found {all_true_deployments.count()} deployments")
            return None

    def check_overlap(self, new_start: datetime, new_end: Optional[datetime], deployment_pk: Optional[int]) -&gt; List[str]:
        """
        Check for overlapping deployments in the given date range, excluding a given deployment.

        Args:
            new_start (datetime): Start of new deployment.
            new_end (Optional[datetime]): End of new deployment (None = indefinite).
            deployment_pk (Optional[int]): Deployment to exclude.

        Returns:
            List[str]: Device IDs of overlapping deployments.
        """
        new_start = check_dt(new_start)
        if new_end is None:
            new_end = new_start + timedelta(days=365 * 100)
        else:
            new_end = check_dt(new_end)
        all_deploys = self.deployments.all().exclude(pk=deployment_pk)
        all_deploys = all_deploys.annotate(deployment_end_indefinite=Case(
            When(deployment_end__isnull=True,
                 then=ExpressionWrapper(F('deployment_start') + timedelta(days=365 * 100), output_field=DateTimeField())),
            default=F('deployment_end')
        ))
        all_deploys = all_deploys.annotate(in_deployment=ExpressionWrapper(
            Q(Q(deployment_end_indefinite__gte=new_start)
              &amp; Q(deployment_start__lte=new_end)),
            output_field=BooleanField()))
        overlapping_deploys = all_deploys.filter(in_deployment=True)
        return list(overlapping_deploys.values_list('deployment_device_ID', flat=True))</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="data_models.models.Device.check_overlap" class="doc doc-heading">
            <code class="highlight language-python">check_overlap(new_start, new_end, deployment_pk)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Check for overlapping deployments in the given date range, excluding a given deployment.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>new_start</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>Start of new deployment.</p>
              </div>
            </li>
            <li>
              <b><code>new_end</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>)
              –
              <div class="doc-md-description">
                <p>End of new deployment (None = indefinite).</p>
              </div>
            </li>
            <li>
              <b><code>deployment_pk</code></b>
                  (<code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>)
              –
              <div class="doc-md-description">
                <p>Deployment to exclude.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
              –
              <div class="doc-md-description">
                <p>List[str]: Device IDs of overlapping deployments.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def check_overlap(self, new_start: datetime, new_end: Optional[datetime], deployment_pk: Optional[int]) -&gt; List[str]:
    """
    Check for overlapping deployments in the given date range, excluding a given deployment.

    Args:
        new_start (datetime): Start of new deployment.
        new_end (Optional[datetime]): End of new deployment (None = indefinite).
        deployment_pk (Optional[int]): Deployment to exclude.

    Returns:
        List[str]: Device IDs of overlapping deployments.
    """
    new_start = check_dt(new_start)
    if new_end is None:
        new_end = new_start + timedelta(days=365 * 100)
    else:
        new_end = check_dt(new_end)
    all_deploys = self.deployments.all().exclude(pk=deployment_pk)
    all_deploys = all_deploys.annotate(deployment_end_indefinite=Case(
        When(deployment_end__isnull=True,
             then=ExpressionWrapper(F('deployment_start') + timedelta(days=365 * 100), output_field=DateTimeField())),
        default=F('deployment_end')
    ))
    all_deploys = all_deploys.annotate(in_deployment=ExpressionWrapper(
        Q(Q(deployment_end_indefinite__gte=new_start)
          &amp; Q(deployment_start__lte=new_end)),
        output_field=BooleanField()))
    overlapping_deploys = all_deploys.filter(in_deployment=True)
    return list(overlapping_deploys.values_list('deployment_device_ID', flat=True))</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Device.clean" class="doc doc-heading">
            <code class="highlight language-python">clean()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Validates device type matches model type.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def clean(self):
    """
    Validates device type matches model type.
    """
    result, message = validators.device_check_type(self.type, self.model)
    if not result:
        raise ValidationError(message)
    super(Device, self).clean()</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Device.deployment_from_date" class="doc doc-heading">
            <code class="highlight language-python">deployment_from_date(dt)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the deployment for this device active at the given datetime.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>dt</code></b>
                  (<code><span title="datetime.datetime">datetime</span></code>)
              –
              <div class="doc-md-description">
                <p>Datetime to check. If None, returns None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><a class="autorefs autorefs-internal" title="Deployment (data_models.models.Deployment)" href="#data_models.models.Deployment">Deployment</a></code>
              –
              <div class="doc-md-description">
                <p>Deployment or None: The matching deployment, or None if ambiguous or not found.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="django.core.exceptions.ObjectDoesNotExist">ObjectDoesNotExist</span></code>
              –
              <div class="doc-md-description">
                <p>If no matching deployment found.</p>
              </div>
            </li>
            <li>
                  <code><span title="django.core.exceptions.MultipleObjectsReturned">MultipleObjectsReturned</span></code>
              –
              <div class="doc-md-description">
                <p>If more than one deployment matches.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def deployment_from_date(self, dt: datetime) -&gt; "Deployment":
    """
    Return the deployment for this device active at the given datetime.

    Args:
        dt (datetime): Datetime to check. If None, returns None.

    Returns:
        Deployment or None: The matching deployment, or None if ambiguous or not found.

    Raises:
        ObjectDoesNotExist: If no matching deployment found.
        MultipleObjectsReturned: If more than one deployment matches.
    """
    logger.info(
        f"Attempt to find deployment for device {self.device_ID} for {dt}")
    if dt is None:
        return None
    all_deploys = self.deployments.all()
    all_tz = all_deploys.values('time_zone', 'pk')
    all_tz = [{'time_zone': x.get(
        'time_zone', settings.TIME_ZONE), 'pk': x['pk']} for x in all_tz]
    all_dt = {x['pk']: check_dt(dt, x['time_zone']) for x in all_tz}
    whens = [When(pk=k, then=Value(v)) for k, v in all_dt.items()]
    all_deploys = all_deploys.annotate(
        dt=Case(*whens, output_field=DateTimeField(), default=Value(None)))
    all_deploys = all_deploys.annotate(deployment_end_indefinite=Case(
        When(deployment_end__isnull=True,
             then=ExpressionWrapper(F('deployment_start') + timedelta(days=365 * 100), output_field=DateTimeField())),
        default=F('deployment_end')
    ))
    all_deploys = all_deploys.annotate(in_deployment=ExpressionWrapper(
        Q(Q(deployment_start__lte=F('dt')) &amp; Q(
            deployment_end_indefinite__gte=F('dt'))),
        output_field=BooleanField()))
    try:
        correct_deployment = all_deploys.get(in_deployment=True)
        return correct_deployment
    except (ObjectDoesNotExist, MultipleObjectsReturned):
        all_true_deployments = all_deploys.filter(in_deployment=True)
        logger.info(
            f"Error: found {all_true_deployments.count()} deployments")
        return None</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Device.is_active" class="doc doc-heading">
            <code class="highlight language-python">is_active()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns True if the device has at least one active deployment.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def is_active(self):
    """
    Returns True if the device has at least one active deployment.
    """
    if self.id:
        return self.deployments.filter(is_active=True).exists()
    return False</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Device.save" class="doc doc-heading">
            <code class="highlight language-python">save(*args, **kwargs)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Assigns the device type from the model if not explicitly set.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def save(self, *args, **kwargs):
    """
    Assigns the device type from the model if not explicitly set.
    """
    if not self.type:
        self.type = self.model.type
    super().save(*args, **kwargs)</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.DeviceModel" class="doc doc-heading">
            <code>DeviceModel</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Represents a type of device, its manufacturer, and data type.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class DeviceModel(BaseModel):
    """
    Represents a type of device, its manufacturer, and data type.
    """
    name = models.CharField(max_length=50, blank=True, unique=True,
                            help_text="Name of device model. Used to find a data handler if available.")
    manufacturer = models.CharField(max_length=50, blank=True,
                                    help_text="Device model manufacturer.")
    type = models.ForeignKey(DataType, models.PROTECT,
                             related_name="device_models", help_text="Primary data type of device.")
    owner = models.ForeignKey(settings.AUTH_USER_MODEL, blank=True, related_name="owned_device_models",
                              on_delete=models.SET_NULL, null=True, help_text="User who registered this device model.")
    colour = ColorField(
        blank=True, help_text="Override data type colour. Leave blank to use the default from this data type.")
    symbol = IconField(
        blank=True, help_text="Override data type symbol. Leave blank to use the default from this data type.")

    def __str__(self):
        return self.name</code></pre>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.Project" class="doc doc-heading">
            <code>Project</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Represents a project and its metadata, including ownership and relations.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class Project(BaseModel):
    """
    Represents a project and its metadata, including ownership and relations.
    """
    project_ID = models.CharField(
        max_length=20, unique=True, blank=True, help_text="Unique project identifier.")
    name = models.CharField(max_length=50, help_text="Full project name.")
    objectives = models.CharField(
        max_length=500, blank=True, help_text="Project objectives description.")
    principal_investigator = models.CharField(
        max_length=50, blank=True, help_text="Full name of principal investigator.")
    principal_investigator_email = models.CharField(
        max_length=100, blank=True, help_text="Principal investigator email.")
    contact = models.CharField(
        max_length=50, blank=True, help_text="Name of primary contact.")
    contact_email = models.CharField(
        max_length=100, blank=True, help_text="Contact email.")
    organisation = models.CharField(
        max_length=100, blank=True, help_text="Organisation with which this project is associated.")
    data_storages = models.ManyToManyField(
        DataStorageInput, related_name="linked_projects", blank=True, help_text="External data storages available to this project."
    )
    archive = models.ForeignKey(
        Archive, related_name="linked_projects", null=True, blank=True, on_delete=models.SET_NULL,
        help_text="Data archive for project data."
    )
    automated_tasks = models.ManyToManyField(
        "ProjectJob", related_name="linked_projects", blank=True)

    def is_active(self):
        """
        Returns True if this project has at least one active deployment, else False.
        """
        if self.id:
            return self.deployments.filter(is_active=True).exists()
        return False

    owner = models.ForeignKey(settings.AUTH_USER_MODEL, blank=True, related_name="owned_projects",
                              on_delete=models.SET_NULL, null=True, db_index=True, help_text="Project owner.")
    managers = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="managed_projects", db_index=True, help_text="Project managers.")
    viewers = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="viewable_projects", db_index=True, help_text="Project viewers.")
    annotators = models.ManyToManyField(
        settings.AUTH_USER_MODEL, blank=True, related_name="annotatable_projects", db_index=True, help_text="Project annotators.")

    clean_time = models.IntegerField(
        default=90, help_text="Days after last modification before archived file is removed from storage.")

    def __str__(self):
        return self.project_ID

    def get_absolute_url(self):
        """
        Returns the absolute URL for the project detail view.
        """
        return reverse('project-detail', kwargs={'pk': self.pk})

    def save(self, *args, **kwargs):
        """
        Auto-generate project_ID if not provided.
        """
        if self.project_ID == "" or self.project_ID is None:
            self.project_ID = self.name[0:10]
        return super().save(*args, **kwargs)</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="data_models.models.Project.get_absolute_url" class="doc doc-heading">
            <code class="highlight language-python">get_absolute_url()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns the absolute URL for the project detail view.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_absolute_url(self):
    """
    Returns the absolute URL for the project detail view.
    """
    return reverse('project-detail', kwargs={'pk': self.pk})</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Project.is_active" class="doc doc-heading">
            <code class="highlight language-python">is_active()</code>

</h3>


    <div class="doc doc-contents ">

        <p>Returns True if this project has at least one active deployment, else False.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def is_active(self):
    """
    Returns True if this project has at least one active deployment, else False.
    """
    if self.id:
        return self.deployments.filter(is_active=True).exists()
    return False</code></pre>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="data_models.models.Project.save" class="doc doc-heading">
            <code class="highlight language-python">save(*args, **kwargs)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Auto-generate project_ID if not provided.</p>


            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def save(self, *args, **kwargs):
    """
    Auto-generate project_ID if not provided.
    """
    if self.project_ID == "" or self.project_ID is None:
        self.project_ID = self.name[0:10]
    return super().save(*args, **kwargs)</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.ProjectJob" class="doc doc-heading">
            <code>ProjectJob</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Represents a project-level job configuration.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class ProjectJob(BaseModel):
    """
    Represents a project-level job configuration.
    """
    job_name = models.CharField(max_length=50, help_text="Name of job")
    celery_job_name = models.CharField(
        max_length=50, help_text="Name of registered celery task.")
    job_args = models.JSONField(
        default=dict, help_text="Additional arguments.")

    def __str__(self):
        return self.job_name

    def get_job_signature(self, file_pks: list) -&gt; dict:
        """
        Generate a job signature for a Celery task.

        Args:
            file_pks (list): List of file primary keys to process.

        Returns:
            dict: Dictionary representing the job signature.
        """
        return get_job_from_name(self.celery_job_name, "datafile", file_pks, self.job_args)</code></pre>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="data_models.models.ProjectJob.get_job_signature" class="doc doc-heading">
            <code class="highlight language-python">get_job_signature(file_pks)</code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a job signature for a Celery task.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>file_pks</code></b>
                  (<code><span title="list">list</span></code>)
              –
              <div class="doc-md-description">
                <p>List of file primary keys to process.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>dict</code></b>(                  <code><span title="dict">dict</span></code>
)              –
              <div class="doc-md-description">
                <p>Dictionary representing the job signature.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>data_models\models.py</code></summary>
              <pre class="highlight"><code class="language-python">def get_job_signature(self, file_pks: list) -&gt; dict:
    """
    Generate a job signature for a Celery task.

    Args:
        file_pks (list): List of file primary keys to process.

    Returns:
        dict: Dictionary representing the job signature.
    """
    return get_job_from_name(self.celery_job_name, "datafile", file_pks, self.job_args)</code></pre>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="data_models.models.Site" class="doc doc-heading">
            <code>Site</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="utils.models.BaseModel">BaseModel</span></code></p>


        <p>Represents a site with a name and an optional short name.</p>
<p>If short_name is blank, it defaults to the first 10 characters of name.</p>







              <details class="quote">
                <summary>Source code in <code>data_models\models.py</code></summary>
                <pre class="highlight"><code class="language-python">class Site(BaseModel):
    """
    Represents a site with a name and an optional short name.

    If short_name is blank, it defaults to the first 10 characters of name.
    """
    name = models.CharField(max_length=50, help_text="Site name.")
    short_name = models.CharField(
        max_length=10, blank=True, help_text="Site short name.")

    def __str__(self):
        return self.name

    def save(self, *args, **kwargs):
        if self.short_name == "":
            self.short_name = self.name[0:10]
        return super().save(*args, **kwargs)</code></pre>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../metadata_functions/" class="btn btn-neutral float-left" title="metadata_functions"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../plotting_functions/" class="btn btn-neutral float-right" title="plotting_functions">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../metadata_functions/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../plotting_functions/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
